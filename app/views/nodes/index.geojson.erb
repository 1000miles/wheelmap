<%- cache("#{I18n.locale}/nodes/bbox_#{[@left, @bottom, @right, @top].join','}", :expires_in => 1.minute) do -%>
{"type":"FeatureCollection","bbox":[<%= @left %>,<%= @bottom %>,<%= @right %>,<%= @top %>],"features":[
<%- @places.each_with_index do |node, index| -%>{"type":"Feature","geometry":{"coordinates":[<%= node.lon%>,<%= node.lat%>],"type":"Point"},"properties": <%= node.tags.reverse_merge!( 'name' => node.headline,
                                                  'address' => node.address,
                                                  'wheelchair' => node.wheelchair,
                                                  'osm_id' => node.osm_id,
                                                  'type' => node.type,
                                                  'category' => node.category.try(:identifier),
                                                  'icon' => image_path(node.icon),
                                                  'marker' => image_path(node.marker)).reject{|k,v| v.blank?}.to_json.html_safe %>}<%= (@places.size == index + 1) ? '' : ',' %><%- end -%>]}<%- end -%>

